<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<meta name="author" content="Peter Jacobs, Pete Zawasky and Mikael Nordman">
<title>Elements of FlashForth 5</title>
<style>
/*! normalize.css v2.1.2 | MIT License | git.io/normalize */
/* ========================================================================== HTML5 display definitions ========================================================================== */
/** Correct `block` display not defined in IE 8/9. */
article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section, summary { display: block; }

/** Correct `inline-block` display not defined in IE 8/9. */
audio, canvas, video { display: inline-block; }

/** Prevent modern browsers from displaying `audio` without controls. Remove excess height in iOS 5 devices. */
audio:not([controls]) { display: none; height: 0; }

/** Address `[hidden]` styling not present in IE 8/9. Hide the `template` element in IE, Safari, and Firefox < 22. */
[hidden], template { display: none; }

script { display: none !important; }

/* ========================================================================== Base ========================================================================== */
/** 1. Set default font family to sans-serif. 2. Prevent iOS text size adjust after orientation change, without disabling user zoom. */
html { font-family: sans-serif; /* 1 */ -ms-text-size-adjust: 100%; /* 2 */ -webkit-text-size-adjust: 100%; /* 2 */ }

/** Remove default margin. */
body { margin: 0; }

/* ========================================================================== Links ========================================================================== */
/** Remove the gray background color from active links in IE 10. */
a { background: transparent; }

/** Address `outline` inconsistency between Chrome and other browsers. */
a:focus { outline: thin dotted; }

/** Improve readability when focused and also mouse hovered in all browsers. */
a:active, a:hover { outline: 0; }

/* ========================================================================== Typography ========================================================================== */
/** Address variable `h1` font-size and margin within `section` and `article` contexts in Firefox 4+, Safari 5, and Chrome. */
h1 { font-size: 2em; margin: 0.67em 0; }

/** Address styling not present in IE 8/9, Safari 5, and Chrome. */
abbr[title] { border-bottom: 1px dotted; }

/** Address style set to `bolder` in Firefox 4+, Safari 5, and Chrome. */
b, strong { font-weight: bold; }

/** Address styling not present in Safari 5 and Chrome. */
dfn { font-style: italic; }

/** Address differences between Firefox and other browsers. */
hr { -moz-box-sizing: content-box; box-sizing: content-box; height: 0; }

/** Address styling not present in IE 8/9. */
mark { background: #ff0; color: #000; }

/** Correct font family set oddly in Safari 5 and Chrome. */
code, kbd, pre, samp { font-family: monospace, serif; font-size: 1em; }

/** Improve readability of pre-formatted text in all browsers. */
pre { white-space: pre-wrap; }

/** Set consistent quote types. */
q { quotes: "\201C" "\201D" "\2018" "\2019"; }

/** Address inconsistent and variable font size in all browsers. */
small { font-size: 80%; }

/** Prevent `sub` and `sup` affecting `line-height` in all browsers. */
sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; }

sup { top: -0.5em; }

sub { bottom: -0.25em; }

/* ========================================================================== Embedded content ========================================================================== */
/** Remove border when inside `a` element in IE 8/9. */
img { border: 0; }

/** Correct overflow displayed oddly in IE 9. */
svg:not(:root) { overflow: hidden; }

/* ========================================================================== Figures ========================================================================== */
/** Address margin not present in IE 8/9 and Safari 5. */
figure { margin: 0; }

/* ========================================================================== Forms ========================================================================== */
/** Define consistent border, margin, and padding. */
fieldset { border: 1px solid #c0c0c0; margin: 0 2px; padding: 0.35em 0.625em 0.75em; }

/** 1. Correct `color` not being inherited in IE 8/9. 2. Remove padding so people aren't caught out if they zero out fieldsets. */
legend { border: 0; /* 1 */ padding: 0; /* 2 */ }

/** 1. Correct font family not being inherited in all browsers. 2. Correct font size not being inherited in all browsers. 3. Address margins set differently in Firefox 4+, Safari 5, and Chrome. */
button, input, select, textarea { font-family: inherit; /* 1 */ font-size: 100%; /* 2 */ margin: 0; /* 3 */ }

/** Address Firefox 4+ setting `line-height` on `input` using `!important` in the UA stylesheet. */
button, input { line-height: normal; }

/** Address inconsistent `text-transform` inheritance for `button` and `select`. All other form control elements do not inherit `text-transform` values. Correct `button` style inheritance in Chrome, Safari 5+, and IE 8+. Correct `select` style inheritance in Firefox 4+ and Opera. */
button, select { text-transform: none; }

/** 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio` and `video` controls. 2. Correct inability to style clickable `input` types in iOS. 3. Improve usability and consistency of cursor style between image-type `input` and others. */
button, html input[type="button"], input[type="reset"], input[type="submit"] { -webkit-appearance: button; /* 2 */ cursor: pointer; /* 3 */ }

/** Re-set default cursor for disabled elements. */
button[disabled], html input[disabled] { cursor: default; }

/** 1. Address box sizing set to `content-box` in IE 8/9. 2. Remove excess padding in IE 8/9. */
input[type="checkbox"], input[type="radio"] { box-sizing: border-box; /* 1 */ padding: 0; /* 2 */ }

/** 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome. 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome (include `-moz` to future-proof). */
input[type="search"] { -webkit-appearance: textfield; /* 1 */ -moz-box-sizing: content-box; -webkit-box-sizing: content-box; /* 2 */ box-sizing: content-box; }

/** Remove inner padding and search cancel button in Safari 5 and Chrome on OS X. */
input[type="search"]::-webkit-search-cancel-button, input[type="search"]::-webkit-search-decoration { -webkit-appearance: none; }

/** Remove inner padding and border in Firefox 4+. */
button::-moz-focus-inner, input::-moz-focus-inner { border: 0; padding: 0; }

/** 1. Remove default vertical scrollbar in IE 8/9. 2. Improve readability and alignment in all browsers. */
textarea { overflow: auto; /* 1 */ vertical-align: top; /* 2 */ }

/* ========================================================================== Tables ========================================================================== */
/** Remove most spacing between table cells. */
table { border-collapse: collapse; border-spacing: 0; }

meta.foundation-mq-small { font-family: "only screen and (min-width: 768px)"; width: 768px; }

meta.foundation-mq-medium { font-family: "only screen and (min-width:1280px)"; width: 1280px; }

meta.foundation-mq-large { font-family: "only screen and (min-width:1440px)"; width: 1440px; }

*, *:before, *:after { -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box; }

html, body { font-size: 100%; }

body { background: white; color: #222222; padding: 0; margin: 0; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-weight: normal; font-style: normal; line-height: 1; position: relative; cursor: auto; }

a:hover { cursor: pointer; }

img, object, embed { max-width: 100%; height: auto; }

object, embed { height: 100%; }

img { -ms-interpolation-mode: bicubic; }

#map_canvas img, #map_canvas embed, #map_canvas object, .map_canvas img, .map_canvas embed, .map_canvas object { max-width: none !important; }

.left { float: left !important; }

.right { float: right !important; }

.text-left { text-align: left !important; }

.text-right { text-align: right !important; }

.text-center { text-align: center !important; }

.text-justify { text-align: justify !important; }

.hide { display: none; }

.antialiased { -webkit-font-smoothing: antialiased; }

img { display: inline-block; vertical-align: middle; }

textarea { height: auto; min-height: 50px; }

select { width: 100%; }

object, svg { display: inline-block; vertical-align: middle; }

.center { margin-left: auto; margin-right: auto; }

.stretch { width: 100%; }

p.lead { font-size: 1.21875em; line-height: 1.6; }

.subheader, .admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { line-height: 1.4; color: #6c818f; font-weight: 300; margin-top: 0.2em; margin-bottom: 0.5em; }

/* Typography resets */
div, dl, dt, dd, ul, ol, li, h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6, pre, form, p, blockquote, th, td { margin: 0; padding: 0; direction: ltr; }

/* Default Link Styles */
a { color: #465158; text-decoration: underline; line-height: inherit; }
a:hover, a:focus { color: #ff0000; }
a img { border: none; }

/* Default paragraph styles */
p { font-family: inherit; font-weight: normal; font-size: 1em; line-height: 1.5; margin-bottom: 1.25em; text-rendering: optimizeLegibility; }
p aside { font-size: 0.875em; line-height: 1.35; font-style: italic; }

/* Default header styles */
h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { font-family: ff-meta-web-pro-1, ff-meta-web-pro-2, Arial, "Helvetica Neue", sans-serif; font-weight: bold; font-style: normal; color: #465158; text-rendering: optimizeLegibility; margin-top: 1em; margin-bottom: 0.5em; line-height: 1.2125em; }
h1 small, h2 small, h3 small, #toctitle small, .sidebarblock > .content > .title small, h4 small, h5 small, h6 small { font-size: 60%; color: #909ea7; line-height: 0; }

h1 { font-size: 2.125em; }

h2 { font-size: 1.6875em; }

h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.375em; }

h4 { font-size: 1.125em; }

h5 { font-size: 1.125em; }

h6 { font-size: 1em; }

hr { border: solid #dddddd; border-width: 1px 0 0; clear: both; margin: 1.25em 0 1.1875em; height: 0; }

/* Helpful Typography Defaults */
em, i { font-style: italic; line-height: inherit; }

strong, b { font-weight: bold; line-height: inherit; }

small { font-size: 60%; line-height: inherit; }

code { font-family: "Consolas", "Deja Vu Sans Mono", "Bitstream Vera Sans Mono", monospace; font-weight: normal; color: #444444; }

/* Lists */
ul, ol, dl { font-size: 1em; line-height: 1.5; margin-bottom: 1.25em; list-style-position: outside; font-family: inherit; }

ul, ol { margin-left: 0; }
ul.no-bullet, ol.no-bullet { margin-left: 0; }

/* Unordered Lists */
ul li ul, ul li ol { margin-left: 1.25em; margin-bottom: 0; font-size: 1em; /* Override nested font-size change */ }
ul.square li ul, ul.circle li ul, ul.disc li ul { list-style: inherit; }
ul.square { list-style-type: square; }
ul.circle { list-style-type: circle; }
ul.disc { list-style-type: disc; }
ul.no-bullet { list-style: none; }

/* Ordered Lists */
ol li ul, ol li ol { margin-left: 1.25em; margin-bottom: 0; }

/* Definition Lists */
dl dt { margin-bottom: 0.3em; font-weight: bold; }
dl dd { margin-bottom: 0.75em; }

/* Abbreviations */
abbr, acronym { text-transform: uppercase; font-size: 90%; color: black; border-bottom: 1px dotted #dddddd; cursor: help; }

abbr { text-transform: none; }

/* Blockquotes */
blockquote { margin: 0 0 1.25em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
blockquote cite { display: block; font-size: 0.8125em; color: #748590; }
blockquote cite:before { content: "\2014 \0020"; }
blockquote cite a, blockquote cite a:visited { color: #748590; }

blockquote, blockquote p { line-height: 1.5; color: #909ea7; }

/* Microformats */
.vcard { display: inline-block; margin: 0 0 1.25em 0; border: 1px solid #dddddd; padding: 0.625em 0.75em; }
.vcard li { margin: 0; display: block; }
.vcard .fn { font-weight: bold; font-size: 0.9375em; }

.vevent .summary { font-weight: bold; }
.vevent abbr { cursor: auto; text-decoration: none; font-weight: bold; border: none; padding: 0 0.0625em; }

@media only screen and (min-width: 768px) { h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; }
  h1 { font-size: 2.75em; }
  h2 { font-size: 2.3125em; }
  h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.6875em; }
  h4 { font-size: 1.4375em; } }
/* Tables */
table { background: white; margin-bottom: 1.25em; border: solid 0 #dddddd; }
table thead, table tfoot { background: none; font-weight: bold; }
table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td { padding: 1px 8px 1px 5px; font-size: 1em; color: #222222; text-align: left; }
table tr th, table tr td { padding: 1px 8px 1px 5px; font-size: 1em; color: #222222; }
table tr.even, table tr.alt, table tr:nth-of-type(even) { background: none; }
table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td { display: table-cell; line-height: 1.5; }

body { -moz-osx-font-smoothing: grayscale; -webkit-font-smoothing: antialiased; tab-size: 4; }

h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; }

.clearfix:before, .clearfix:after, .float-group:before, .float-group:after { content: " "; display: table; }
.clearfix:after, .float-group:after { clear: both; }

:not(pre):not([class^=L]) > code { font-size: 0.95em; font-style: normal !important; letter-spacing: 0; padding: 0; background-color: #f2f2f2; -webkit-border-radius: 6px; border-radius: 6px; line-height: inherit; word-wrap: break-word; }

:not(pre) > code.nobreak { word-wrap: normal; }
:not(pre) > code.nowrap { white-space: nowrap; }

pre { color: inherit; font-family: "Consolas", "Deja Vu Sans Mono", "Bitstream Vera Sans Mono", monospace; line-height: 1.2; }
pre code, pre pre { color: inherit; font-size: inherit; line-height: inherit; }
pre > code { display: block; }

pre.nowrap, pre.nowrap pre { white-space: pre; word-wrap: normal; }

em em { font-style: normal; }

strong strong { font-weight: normal; }

.keyseq { color: #333333; }

kbd { font-family: "Consolas", "Deja Vu Sans Mono", "Bitstream Vera Sans Mono", monospace; display: inline-block; color: black; font-size: 0.65em; line-height: 1.45; background-color: #f7f7f7; border: 1px solid #ccc; -webkit-border-radius: 3px; border-radius: 3px; -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; margin: 0 0.15em; padding: 0.2em 0.5em; vertical-align: middle; position: relative; top: -0.1em; white-space: nowrap; }

.keyseq kbd:first-child { margin-left: 0; }

.keyseq kbd:last-child { margin-right: 0; }

.menuseq, .menuref { color: #000; }

.menuseq b:not(.caret), .menuref { font-weight: inherit; }

.menuseq { word-spacing: -0.02em; }
.menuseq b.caret { font-size: 1.25em; line-height: 0.8; }
.menuseq i.caret { font-weight: bold; text-align: center; width: 0.45em; }

b.button:before, b.button:after { position: relative; top: -1px; font-weight: normal; }

b.button:before { content: "["; padding: 0 3px 0 2px; }

b.button:after { content: "]"; padding: 0 2px 0 3px; }

p a > code:hover { color: #373737; }

#header, #content, #footnotes, #footer { width: 100%; margin-left: auto; margin-right: auto; margin-top: 0; margin-bottom: 0; max-width: 62.5em; *zoom: 1; position: relative; padding-left: 0.9375em; padding-right: 0.9375em; }
#header:before, #header:after, #content:before, #content:after, #footnotes:before, #footnotes:after, #footer:before, #footer:after { content: " "; display: table; }
#header:after, #content:after, #footnotes:after, #footer:after { clear: both; }

#content { margin-top: 1.25em; }

#content:before { content: none; }

#header > h1:first-child { color: #111111; margin-top: 2.25rem; margin-bottom: 0; }
#header > h1:first-child + #toc { margin-top: 8px; border-top: 1px solid #dddddd; }
#header > h1:only-child, body.toc2 #header > h1:nth-last-child(2) { border-bottom: 1px solid #dddddd; padding-bottom: 8px; }
#header .details { border-bottom: 1px solid #dddddd; line-height: 1.45; padding-top: 0.25em; padding-bottom: 0.25em; padding-left: 0.25em; color: #748590; display: -ms-flexbox; display: -webkit-flex; display: flex; -ms-flex-flow: row wrap; -webkit-flex-flow: row wrap; flex-flow: row wrap; }
#header .details span:first-child { margin-left: -0.125em; }
#header .details span.email a { color: #909ea7; }
#header .details br { display: none; }
#header .details br + span:before { content: "\00a0\2013\00a0"; }
#header .details br + span.author:before { content: "\00a0\22c5\00a0"; color: #909ea7; }
#header .details br + span#revremark:before { content: "\00a0|\00a0"; }
#header #revnumber { text-transform: capitalize; }
#header #revnumber:after { content: "\00a0"; }

#content > h1:first-child:not([class]) { color: #ffffff; border-bottom: 1px solid #dddddd; padding-bottom: 8px; margin-top: 0; padding-top: 1rem; margin-bottom: 1.25rem; }

#toc { border-bottom: 1px solid #dddddd; padding-bottom: 0.5em; }
#toc > ul { margin-left: 0.125em; }
#toc ul.sectlevel0 > li > a { font-style: italic; color: #ffffff; }
#toc ul.sectlevel0 ul.sectlevel1 { margin: 0.5em 0; }
#toc ul { font-family: ff-meta-web-pro-1, ff-meta-web-pro-2, Arial, "Helvetica Neue", sans-serif; list-style-type: none; color: #ffffff; }
#toc li { line-height: 1.3334; margin-top: 0.3334em; }
#toc a { color: #ffffff; text-decoration: none; }
#toc a:active { text-decoration: underline; }

#toctitle { color: #ffffff; font-size: 1.2em; }
#toc-dot-leader { color: #ffffff; }

@media only screen and (min-width: 768px) { #toctitle { font-size: 1.375em; }
  body.toc2 { padding-left: 15em; padding-right: 0; }
  #toc.toc2 { margin-top: 0 !important; background: #000000; position: fixed; width: 15em; left: 0; top: 0; border-right: 1px solid #dddddd; border-top-width: 0 !important; border-bottom-width: 0 !important; z-index: 1000; padding: 1.25em 1em; height: 100%; overflow: auto; }
  #toc.toc2 #toctitle { margin-top: 0; margin-bottom: 0.8rem; font-size: 1.2em; }
  #toc.toc2 > ul { font-size: 0.9em; margin-bottom: 0; }
  #toc.toc2 ul ul { margin-left: 0; padding-left: 1em; }
  #toc.toc2 ul.sectlevel0 ul.sectlevel1 { padding-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 15em; }
  body.toc2.toc-right #toc.toc2 { border-right-width: 0; border-left: 1px solid #dddddd; left: auto; right: 0; } }
@media only screen and (min-width: 1280px) { body.toc2 { padding-left: 20em; padding-right: 0; }
  #toc.toc2 { width: 20em; }
  #toc.toc2 #toctitle { font-size: 1.375em; }
  #toc.toc2 > ul { font-size: 0.95em; }
  #toc.toc2 ul ul { padding-left: 1.25em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 20em; } }
#content #toc { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; -webkit-border-radius: 6px; border-radius: 6px; }
#content #toc > :first-child { margin-top: 0; }
#content #toc > :last-child { margin-bottom: 0; }

#footer { max-width: 100%; background: black; padding: 1.25em; }

#footer-text { color: white; line-height: 1.35; }

#content { margin-bottom: 0.625em; }

.sect1 { padding-bottom: 0.625em; }

@media only screen and (min-width: 768px) { #content { margin-bottom: 1.25em; }
  .sect1 { padding-bottom: 1.25em; } }
.sect1:last-child { padding-bottom: 0; }

.sect1 + .sect1 { border-top: 1px solid #dddddd; }

#content h1 > a.anchor, h2 > a.anchor, h3 > a.anchor, #toctitle > a.anchor, .sidebarblock > .content > .title > a.anchor, h4 > a.anchor, h5 > a.anchor, h6 > a.anchor { position: absolute; z-index: 1001; width: 1.5ex; margin-left: -1.5ex; display: block; text-decoration: none !important; visibility: hidden; text-align: center; font-weight: normal; }
#content h1 > a.anchor:before, h2 > a.anchor:before, h3 > a.anchor:before, #toctitle > a.anchor:before, .sidebarblock > .content > .title > a.anchor:before, h4 > a.anchor:before, h5 > a.anchor:before, h6 > a.anchor:before { content: "\00A7"; font-size: 0.85em; display: block; padding-top: 0.1em; }
#content h1:hover > a.anchor, #content h1 > a.anchor:hover, h2:hover > a.anchor, h2 > a.anchor:hover, h3:hover > a.anchor, #toctitle:hover > a.anchor, .sidebarblock > .content > .title:hover > a.anchor, h3 > a.anchor:hover, #toctitle > a.anchor:hover, .sidebarblock > .content > .title > a.anchor:hover, h4:hover > a.anchor, h4 > a.anchor:hover, h5:hover > a.anchor, h5 > a.anchor:hover, h6:hover > a.anchor, h6 > a.anchor:hover { visibility: visible; }
#content h1 > a.link, h2 > a.link, h3 > a.link, #toctitle > a.link, .sidebarblock > .content > .title > a.link, h4 > a.link, h5 > a.link, h6 > a.link { color: #ffffff; text-decoration: none; }
#content h1 > a.link:hover, h2 > a.link:hover, h3 > a.link:hover, #toctitle > a.link:hover, .sidebarblock > .content > .title > a.link:hover, h4 > a.link:hover, h5 > a.link:hover, h6 > a.link:hover { color: #ffffff; }

details, .audioblock, .imageblock, .literalblock, .listingblock, .stemblock, .videoblock { margin-bottom: 1.25em; }

details > summary:first-of-type { cursor: pointer; display: list-item; outline: none; margin-bottom: 0.75em; }

.admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { text-rendering: optimizeLegibility; text-align: left; }

table.tableblock.fit-content > caption.title { white-space: nowrap; width: 0; }

.paragraph.lead > p, #preamble > .sectionbody > [class="paragraph"]:first-of-type p { font-size: 1.21875em; line-height: 1.6; color: #111111; }

table.tableblock #preamble > .sectionbody > [class="paragraph"]:first-of-type p { font-size: inherit; }

.admonitionblock > table { border-collapse: separate; border: 0; background: none; width: 100%; }
.admonitionblock > table td.icon { text-align: center; width: 80px; }
.admonitionblock > table td.icon img { max-width: none; }
.admonitionblock > table td.icon .title { font-weight: bold; font-family: ff-meta-web-pro-1, ff-meta-web-pro-2, Arial, "Helvetica Neue", sans-serif; text-transform: uppercase; }
.admonitionblock > table td.content { padding-left: 1.125em; padding-right: 1.25em; border-left: 1px solid #dddddd; color: #748590; }
.admonitionblock > table td.content > :last-child > :last-child { margin-bottom: 0; }

.exampleblock > .content { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: white; -webkit-border-radius: 6px; border-radius: 6px; }
.exampleblock > .content > :first-child { margin-top: 0; }
.exampleblock > .content > :last-child { margin-bottom: 0; }

.sidebarblock { border-style: solid; border-width: 1px; border-color: #d4d4d4; margin-bottom: 1.25em; padding: 1.25em; background: #ededed; -webkit-border-radius: 6px; border-radius: 6px; }
.sidebarblock > :first-child { margin-top: 0; }
.sidebarblock > :last-child { margin-bottom: 0; }
.sidebarblock > .content > .title { color: #6c818f; margin-top: 0; }

.exampleblock > .content > :last-child > :last-child, .exampleblock > .content .olist > ol > li:last-child > :last-child, .exampleblock > .content .ulist > ul > li:last-child > :last-child, .exampleblock > .content .qlist > ol > li:last-child > :last-child, .sidebarblock > .content > :last-child > :last-child, .sidebarblock > .content .olist > ol > li:last-child > :last-child, .sidebarblock > .content .ulist > ul > li:last-child > :last-child, .sidebarblock > .content .qlist > ol > li:last-child > :last-child { margin-bottom: 0; }

.literalblock pre, .listingblock > .content > pre { border: 1px solid #cccccc; -webkit-border-radius: 6px; border-radius: 6px; word-wrap: break-word; overflow-x: auto; padding: 0.5em; font-size: 0.8125em; }
@media only screen and (min-width: 768px) { .literalblock pre, .listingblock > .content > pre { font-size: 0.90625em; } }
@media only screen and (min-width: 1280px) { .literalblock pre, .listingblock > .content > pre { font-size: 1em; } }

.literalblock pre, .listingblock > .content > pre:not(.highlight), .listingblock > .content > pre[class="highlight"], .listingblock > .content > pre[class^="highlight "] { background: #eeeeee; }

.literalblock.output pre { color: #eeeeee; background-color: inherit; }

.listingblock > .content { position: relative; }

.listingblock code[data-lang]:before { display: none; content: attr(data-lang); position: absolute; font-size: 0.75em; top: 0.425rem; right: 0.5rem; line-height: 1; text-transform: uppercase; color: inherit; opacity: 0.5; }

.listingblock:hover code[data-lang]:before { display: block; }

.listingblock.terminal pre .command:before { content: attr(data-prompt); padding-right: 0.5em; color: inherit; opacity: 0.5; }

.listingblock.terminal pre .command:not([data-prompt]):before { content: "$"; }

.listingblock pre.highlightjs { padding: 0; }
.listingblock pre.highlightjs > code { padding: 0.5em; -webkit-border-radius: 6px; border-radius: 6px; }

.prettyprint { background: #eeeeee; }

pre.prettyprint .linenums { line-height: 1.2; margin-left: 2em; }

pre.prettyprint li { background: none; list-style-type: inherit; padding-left: 0; }

pre.prettyprint li code[data-lang]:before { opacity: 1; }

pre.prettyprint li:not(:first-child) code[data-lang]:before { display: none; }

table.linenotable { border-collapse: separate; border: 0; margin-bottom: 0; background: none; }
table.linenotable td[class] { color: inherit; vertical-align: top; padding: 0; line-height: inherit; white-space: normal; }
table.linenotable td.code { padding-left: 0.75em; }
table.linenotable td.linenos { border-right: 1px solid currentColor; opacity: 0.35; padding-right: 0.5em; }

pre.pygments .lineno { border-right: 1px solid currentColor; opacity: 0.35; display: inline-block; margin-right: 0.75em; }
pre.pygments .lineno:before { content: ""; margin-right: -0.125em; }

.quoteblock { margin: 0 1em 1.25em 1.5em; display: table; }
.quoteblock:not(.excerpt) > .title { margin-left: -1.5em; margin-bottom: 0.75em; }
.quoteblock blockquote, .quoteblock p { color: #909ea7; font-size: 1.15rem; line-height: 1.75; word-spacing: 0.1em; letter-spacing: 0; font-style: italic; text-align: justify; }
.quoteblock blockquote { margin: 0; padding: 0; border: 0; }
.quoteblock blockquote:before { content: "\201c"; float: left; font-size: 2.75em; font-weight: bold; line-height: 0.6em; margin-left: -0.6em; color: #6c818f; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1); }
.quoteblock blockquote > .paragraph:last-child p { margin-bottom: 0; }
.quoteblock .attribution { margin-top: 0.75em; margin-right: 0.5ex; text-align: right; }

.verseblock { margin: 0 1em 1.25em 1em; }
.verseblock pre { font-family: "Open Sans", "DejaVu Sans", sans; font-size: 1.15rem; color: #909ea7; font-weight: 300; text-rendering: optimizeLegibility; }
.verseblock pre strong { font-weight: 400; }
.verseblock .attribution { margin-top: 1.25rem; margin-left: 0.5ex; }

.quoteblock .attribution, .verseblock .attribution { font-size: 0.8125em; line-height: 1.45; font-style: italic; }
.quoteblock .attribution br, .verseblock .attribution br { display: none; }
.quoteblock .attribution cite, .verseblock .attribution cite { display: block; letter-spacing: -0.025em; color: #748590; }

.quoteblock.abstract blockquote:before, .quoteblock.excerpt blockquote:before, .quoteblock .quoteblock blockquote:before { display: none; }
.quoteblock.abstract blockquote, .quoteblock.abstract p, .quoteblock.excerpt blockquote, .quoteblock.excerpt p, .quoteblock .quoteblock blockquote, .quoteblock .quoteblock p { line-height: 1.6; word-spacing: 0; }
.quoteblock.abstract { margin: 0 1em 1.25em 1em; display: block; }
.quoteblock.abstract > .title { margin: 0 0 0.375em 0; font-size: 1.15em; text-align: center; }
.quoteblock.excerpt > blockquote, .quoteblock .quoteblock { padding: 0 0 0.25em 1em; border-left: 0.25em solid #dddddd; }
.quoteblock.excerpt, .quoteblock .quoteblock { margin-left: 0; }
.quoteblock.excerpt blockquote, .quoteblock.excerpt p, .quoteblock .quoteblock blockquote, .quoteblock .quoteblock p { color: inherit; font-size: 1.0625rem; }
.quoteblock.excerpt .attribution, .quoteblock .quoteblock .attribution { color: inherit; text-align: left; margin-right: 0; }

table.tableblock { max-width: 100%; border-collapse: separate; }

p.tableblock:last-child { margin-bottom: 0; }

td.tableblock > .content { margin-bottom: 1.25em; }
td.tableblock > .content > :last-child { margin-bottom: -1.25em; }

table.tableblock, th.tableblock, td.tableblock { border: 0 solid #dddddd; }

table.grid-all > thead > tr > .tableblock, table.grid-all > tbody > tr > .tableblock { border-width: 0 0 0 0; }

table.grid-all > tfoot > tr > .tableblock { border-width: 0 0 0 0; }

table.grid-cols > * > tr > .tableblock { border-width: 0 0 0 0; }

table.grid-rows > thead > tr > .tableblock, table.grid-rows > tbody > tr > .tableblock { border-width: 0 0 0 0; }

table.grid-rows > tfoot > tr > .tableblock { border-width: 0 0 0 0; }

table.grid-all > * > tr > .tableblock:last-child, table.grid-cols > * > tr > .tableblock:last-child { border-right-width: 0; }

table.grid-all > tbody > tr:last-child > .tableblock, table.grid-all > thead:last-child > tr > .tableblock, table.grid-rows > tbody > tr:last-child > .tableblock, table.grid-rows > thead:last-child > tr > .tableblock { border-bottom-width: 0; }

table.frame-all { border-width: 0; }

table.frame-sides { border-width: 0 0; }

table.frame-topbot, table.frame-ends { border-width: 0 0; }

table.stripes-all tr, table.stripes-odd tr:nth-of-type(odd), table.stripes-even tr:nth-of-type(even), table.stripes-hover tr:hover { background: none; }

th.halign-left, td.halign-left { text-align: left; }

th.halign-right, td.halign-right { text-align: right; }

th.halign-center, td.halign-center { text-align: center; }

th.valign-top, td.valign-top { vertical-align: top; }

th.valign-bottom, td.valign-bottom { vertical-align: bottom; }

th.valign-middle, td.valign-middle { vertical-align: middle; }

table thead th, table tfoot th { font-weight: bold; }

tbody tr th { display: table-cell; line-height: 1.5; background: none; }

tbody tr th, tbody tr th p, tfoot tr th, tfoot tr th p { color: #222222; font-weight: bold; }

p.tableblock > code:only-child { background: none; padding: 0; }

p.tableblock { font-size: 1em; }

ol { margin-left: 0.25em; }

ul li ol { margin-left: 0; }

dl dd { margin-left: 1.125em; }

dl dd:last-child, dl dd:last-child > :last-child { margin-bottom: 0; }

ol > li p, ul > li p, ul dd, ol dd, .olist .olist, .ulist .ulist, .ulist .olist, .olist .ulist { margin-bottom: 0.625em; }

ul.checklist, ul.none, ol.none, ul.no-bullet, ol.no-bullet, ol.unnumbered, ul.unstyled, ol.unstyled { list-style-type: none; }

ul.no-bullet, ol.no-bullet, ol.unnumbered { margin-left: 0.625em; }

ul.unstyled, ol.unstyled { margin-left: 0; }

ul.checklist { margin-left: 0.625em; }

ul.checklist li > p:first-child > .fa-square-o:first-child, ul.checklist li > p:first-child > .fa-check-square-o:first-child { width: 1.25em; font-size: 0.8em; position: relative; bottom: 0.125em; }

ul.checklist li > p:first-child > input[type="checkbox"]:first-child { margin-right: 0.25em; }

ul.inline { display: -ms-flexbox; display: -webkit-box; display: flex; -ms-flex-flow: row wrap; -webkit-flex-flow: row wrap; flex-flow: row wrap; list-style: none; margin: 0 0 0.625em -1.25em; }

ul.inline > li { margin-left: 1.25em; }

.unstyled dl dt { font-weight: normal; font-style: normal; }

ol.arabic { list-style-type: decimal; }

ol.decimal { list-style-type: decimal-leading-zero; }

ol.loweralpha { list-style-type: lower-alpha; }

ol.upperalpha { list-style-type: upper-alpha; }

ol.lowerroman { list-style-type: lower-roman; }

ol.upperroman { list-style-type: upper-roman; }

ol.lowergreek { list-style-type: lower-greek; }

.hdlist > table, .colist > table { border: 0; background: none; }
.hdlist > table > tbody > tr, .colist > table > tbody > tr { background: none; }

td.hdlist1, td.hdlist2 { vertical-align: top; padding: 0 0.625em; }

td.hdlist1 { font-weight: bold; padding-bottom: 1.25em; }

.literalblock + .colist, .listingblock + .colist { margin-top: -0.5em; }

.colist td:not([class]):first-child { padding: 0.4em 0.75em 0 0.75em; line-height: 1; vertical-align: top; }
.colist td:not([class]):first-child img { max-width: none; }
.colist td:not([class]):last-child { padding: 0.25em 0; }

.thumb, .th { line-height: 0; display: inline-block; border: solid 4px white; -webkit-box-shadow: 0 0 0 1px #dddddd; box-shadow: 0 0 0 1px #dddddd; }

.imageblock.left { margin: 0.25em 0.625em 1.25em 0; }
.imageblock.right { margin: 0.25em 0 1.25em 0.625em; }
.imageblock > .title { margin-bottom: 0; }
.imageblock.thumb, .imageblock.th { border-width: 6px; }
.imageblock.thumb > .title, .imageblock.th > .title { padding: 0 0.125em; }

.image.left, .image.right { margin-top: 0.25em; margin-bottom: 0.25em; display: inline-block; line-height: 0; }
.image.left { margin-right: 0.625em; }
.image.right { margin-left: 0.625em; }

a.image { text-decoration: none; display: inline-block; }
a.image object { pointer-events: none; }

sup.footnote, sup.footnoteref { font-size: 0.875em; position: static; vertical-align: super; }
sup.footnote a, sup.footnoteref a { text-decoration: none; }
sup.footnote a:active, sup.footnoteref a:active { text-decoration: underline; }

#footnotes { padding-top: 0.75em; padding-bottom: 0.75em; margin-bottom: 0.625em; }
#footnotes hr { width: 20%; min-width: 6.25em; margin: -0.25em 0 0.75em 0; border-width: 1px 0 0 0; }
#footnotes .footnote { padding: 0 0.375em 0 0.225em; line-height: 1.3334; font-size: 0.875em; margin-left: 1.2em; margin-bottom: 0.2em; }
#footnotes .footnote a:first-of-type { font-weight: bold; text-decoration: none; margin-left: -1.05em; }
#footnotes .footnote:last-of-type { margin-bottom: 0; }
#content #footnotes { margin-top: -0.625em; margin-bottom: 0; padding: 0.75em 0; }

.gist .file-data > table { border: 0; background: #fff; width: 100%; margin-bottom: 0; }
.gist .file-data > table td.line-data { width: 99%; }

div.unbreakable { page-break-inside: avoid; }

.big { font-size: larger; }

.small { font-size: smaller; }

.underline { text-decoration: underline; }

.overline { text-decoration: overline; }

.line-through { text-decoration: line-through; }

.aqua { color: #00bfbf; }

.aqua-background { background-color: #00fafa; }

.black { color: black; }

.black-background { background-color: black; }

.blue { color: #0000bf; }

.blue-background { background-color: #0000fa; }

.fuchsia { color: #bf00bf; }

.fuchsia-background { background-color: #fa00fa; }

.gray { color: #606060; }

.gray-background { background-color: #7d7d7d; }

.green { color: #006000; }

.green-background { background-color: #007d00; }

.lime { color: #00bf00; }

.lime-background { background-color: #00fa00; }

.maroon { color: #600000; }

.maroon-background { background-color: #7d0000; }

.navy { color: #000060; }

.navy-background { background-color: #00007d; }

.olive { color: #606000; }

.olive-background { background-color: #7d7d00; }

.purple { color: #600060; }

.purple-background { background-color: #7d007d; }

.red { color: #bf0000; }

.red-background { background-color: #fa0000; }

.silver { color: #909090; }

.silver-background { background-color: #bcbcbc; }

.teal { color: #006060; }

.teal-background { background-color: #007d7d; }

.white { color: #bfbfbf; }

.white-background { background-color: #fafafa; }

.yellow { color: #bfbf00; }

.yellow-background { background-color: #fafa00; }

span.icon > .fa { cursor: default; }
a span.icon > .fa { cursor: inherit; }

.admonitionblock td.icon [class^="fa icon-"] { font-size: 2.5em; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); cursor: default; }
.admonitionblock td.icon .icon-note:before { content: "\f05a"; color: #333333; }
.admonitionblock td.icon .icon-tip:before { content: "\f0eb"; text-shadow: 1px 1px 2px rgba(155, 155, 0, 0.8); color: #111; }
.admonitionblock td.icon .icon-warning:before { content: "\f071"; color: #bf6900; }
.admonitionblock td.icon .icon-caution:before { content: "\f06d"; color: #bf3400; }
.admonitionblock td.icon .icon-important:before { content: "\f06a"; color: #bf0000; }

.conum[data-value] { display: inline-block; color: #fff !important; background-color: black; -webkit-border-radius: 50%; border-radius: 50%; text-align: center; font-size: 0.75em; width: 1.67em; height: 1.67em; line-height: 1.67em; font-family: "Open Sans", "DejaVu Sans", sans-serif; font-style: normal; font-weight: bold; }
.conum[data-value] * { color: #fff !important; }
.conum[data-value] + b { display: none; }
.conum[data-value]:after { content: attr(data-value); }
pre .conum[data-value] { position: relative; top: -0.125em; }

b.conum * { color: inherit !important; }

.conum:not([data-value]):empty { display: none; }

h4 { color: #6c818f; }

.literalblock > .content > pre, .listingblock > .content > pre { -webkit-border-radius: 6px; border-radius: 6px; margin-left: 2em; margin-right: 2em; }

.admonitionblock { margin-left: 2em; margin-right: 2em; }
.admonitionblock > table { border: 1px solid #609060; border-top-width: 1.5em; background-color: #e9ffe9; border-collapse: separate; -webkit-border-radius: 0; border-radius: 0; }
.admonitionblock > table td.icon { padding-top: .5em; padding-bottom: .5em; }
.admonitionblock > table td.content { padding: .5em 1em; color: black; font-size: .9em; border-left: none; }

.sidebarblock { background-color: #e8ecef; border-color: #ccc; }
.sidebarblock > .content > .title { color: #444444; }

table.tableblock.grid-all { border-collapse: collapse; -webkit-border-radius: 0; border-radius: 0; }
table.tableblock.grid-all th.tableblock, table.tableblock.grid-all td.tableblock { border-bottom: 1px solid #aaa; }

#footer { background-color: #000000; padding: 2em; }

#footer-text { color: #ffffff; font-size: 0.8em; text-align: center; }

</style>
</head>
<body class="article toc2 toc-right">
<div id="header">
<h1>Elements of FlashForth 5</h1>
<div class="details">
<span id="author" class="author">Peter Jacobs, Pete Zawasky and Mikael Nordman</span><br>
<span id="revdate">2021-12-30</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_introduction">1. Introduction</a></li>
<li><a href="#_getting_started">2. Getting started</a></li>
<li><a href="#_the_interpreter">3. The interpreter</a></li>
<li><a href="#_extending_the_dictionary">4. Extending the dictionary</a>
<ul class="sectlevel2">
<li><a href="#_dictionary_management">4.1. Dictionary management</a></li>
</ul>
</li>
<li><a href="#_stacks_and_reverse_polish_notation">5. Stacks and reverse Polish notation</a>
<ul class="sectlevel2">
<li><a href="#_manipulating_the_parameter_stack">5.1. Manipulating the parameter stack</a></li>
<li><a href="#_the_return_stack_and_its_uses">5.2. The return stack and its uses</a></li>
</ul>
</li>
<li><a href="#_using_memory">6. Using memory</a>
<ul class="sectlevel2">
<li><a href="#_variables">6.1. Variables</a></li>
<li><a href="#_constants">6.2. Constants</a></li>
<li><a href="#_values">6.3. Values</a></li>
<li><a href="#_basic_tools_for_allocating_memory">6.4. Basic tools for allocating memory</a></li>
</ul>
</li>
<li><a href="#_comparing_and_branching">7. Comparing and branching</a></li>
<li><a href="#_comments_in_forth_code">8. Comments in Forth code</a></li>
<li><a href="#_integer_arithmetic_operations">9. Integer arithmetic operations</a></li>
<li><a href="#_a_little_more_on_compiling">10. A little more on compiling</a></li>
<li><a href="#_looping_and_structured_programming">11. Looping and structured programming</a></li>
<li><a href="#_more_on_defining_words">12. More on defining words</a>
<ul class="sectlevel2">
<li><a href="#_create_does">12.1. create &#8230;&#8203; does&gt; &#8230;&#8203;</a></li>
<li><a href="#_creating_arrays">12.2. Creating arrays</a></li>
<li><a href="#_jump_tables">12.3. Jump tables</a></li>
</ul>
</li>
<li><a href="#_strings">13. Strings</a>
<ul class="sectlevel2">
<li><a href="#_pictured_numeric_output">13.1. Pictured numeric output</a></li>
</ul>
</li>
<li><a href="#_forth_programming_style">14. Forth programming style</a></li>
<li><a href="#_references">References</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This document is a remix of material from a number of Forth tutorials and references,
adapted to the FlashForth 5 environment.
It provides some examples and explanation of using FlashForth on a PIC18 microcontroller
while concentrating on the features of the language rather than the details of the
microcontroller hardware.
Following an introduction to the FlashForth interpreter,
we look at adding our own word definitions to the dictionary and then explore
the manipulation of data values on the stack.
Flow of program control and more advanced defining words are also explored.
These defining words are convenient for making arrays.
Finally, strings and formatted numeric output are discussed.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_introduction">1. Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Forth is an interesting mix of low-level access tools and language building tools.
It is effectively a small toolkit with which you construct a specialized dictionary of words
that work together to form your application code.
This tutorial will explore and explain the workings of the FlashForth 5 toolkit
running on a Microchip PIC18 microcontroller
and complements the more hardware-oriented tutorial,
the FlashForth quick reference and the <a href="https://flashforth.com">FlashForth website</a>.
Our interest is in using Forth on the microcontroller in an embedded system,
such as a special-purpose signal timing device,
rather than as part of a general-purpose calculation on a personal computer.</p>
</div>
<div class="paragraph">
<p>There are quite a number of
good introductory tutorials<sup><a href="#brodie_1987">1</a>,<a href="#noble_2001">4</a></sup>,
course notes<sup><a href="#pelc_2011">5</a></sup>, and references<sup><a href="#conklin_2007">3</a></sup>
for programming in Forth on a desktop or laptop computer,
however, FlashForth running on a PIC18 microcontroller is a different environment.
In the following sections,
we will follow closely J.V. Noble&#8217;s tutorial<sup><a href="#noble_2001">4</a></sup>
for using Forth on a personal computer,
reusing many of his examples and explanations verbatim,
while adapting the overall tutorial to the use of FlashForth on a microcontroller.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_getting_started">2. Getting started</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Although we will be using FlashForth on a PIC18 microcontroller, we communicate with it
using a serial terminal program running on a personal computer.
FlashForth comes with a couple of terminal programs (in Python and Tcl/Tk)
that have some conveniences when sending files to the microcontroller,
so we will start our interaction with one of those.
Starting the <code>ff-shell.tcl</code> program in a normal terminal window
will start up the Tcl/Tk shell program.
Pressing the <code>Enter</code> key &#x23CE; a couple of times should get the display
as shown in Figure 1.
The <code>ok&lt;#,ram&gt;</code> prompt indicates that the current base is ten,
for representing numbers in decimal format,
and that the current context for making variables is static RAM,
rather than the Flash memory and EEPROM that is also available in the microcontroller.</p>
</div>
<div id="opening_screen" class="imageblock">
<div class="content">
<img src="../figs/ff5-start-screen-ff-shell-tcl.png" alt="ff5 start screen ff shell tcl" width="80%">
</div>
<div class="title">Figure 1. Opening screen using <code>ff-shell.tcl</code>.</div>
</div>
<div class="paragraph">
<p>In contrast to Forth on a PC, FlashForth is case sensitive,
with most predefined words being spelled with lower case.
Also, being intended for use in an embedded system, there is no command to exit the system.
FlashForth only stops when the power is removed or a reset occurs.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_interpreter">3. The interpreter</h2>
<div class="sectionbody">
<div class="paragraph">
<p>FlashForth is an interactive programming language consisting of <em>words</em>.
Forth words are the equivalent of subroutines or functions in other languages and are
executed by naming them.
Although FlashForth is interactive at its core, the user doesn&#8217;t need to
interact with an embedded application if its top-level word is set to automatically
execute at power-up.</p>
</div>
<div class="paragraph">
<p>Here is an example of executing a FlashForth word:<br>
<code>hex</code> &#x23CE;  <code>ok&lt;$,ram&gt;</code><br>
This executes the word that sets the base for representing numbers to 16,
a format that you are likely to be familiar with
if you are a student of mechatronics or computing.
Note that both the text that your typed and the FlashForth response is shown
together, on either side of the <code>Enter</code> symbol &#x23CE;.
For the moment, let&#8217;s return to using decimal numbers:<br>
<code>decimal</code> &#x23CE; `  ok&lt;#,ram&gt;`</p>
</div>
<div class="paragraph">
<p>Now, let&#8217;s try something a bit more interesting by entering:<br>
<code>2 17 + .</code> &#x23CE; <code>19 &lt;#,ram&gt;</code><br>
This time FlashForth more clearly shows its interpretive nature.
A small program called the <em>outer interpreter</em> continually loops,
waiting for input from the serial port.
The input is a sequence of text strings (words or numbers) separated from each other
by the standard Forth delimiter, one or more ASCII blank characters.</p>
</div>
<div class="paragraph">
<p>The text strings are interpreted in only three ways: words (subroutine or function names),
numbers, or <em>not defined</em>.
The outer interpreter tries first to look for the incoming word in the <em>dictionary</em>
that contains the already defined words.
If it finds the word, it executes the corresponding code.</p>
</div>
<div class="paragraph">
<p>If no dictionary entry exists, the interpreter tries to read the input as a number.
If the string satisfies the rules for defining a number, it is converted to a number
in the microcontroller&#8217;s internal representation, and stored in a special memory location,
called the <em>top of stack</em> (<code>TOS</code>).</p>
</div>
<div class="paragraph">
<p>In the example above, FlashForth interpreted 2 and 17 as numbers,
and pushed them onto the stack.
<code>+</code> is a predefined word, as is <code>.</code>, so they are looked up and executed.
The <code>+</code> (plus) word removed <code>2</code> and <code>17</code> from the stack, added them together,
and left the result <code>19</code> on the stack.
The word <code>.</code> (dot) removed <code>19</code> from the stack and sent it to the standard output device,
the serial port for FlashForth.
Here is a picture of the stack through the process.
The second-top element of the stack is labelled <code>NOS</code> for <em>next on stack</em>.<br></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">word executed</th>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top"><code>2</code></th>
<th class="tableblock halign-left valign-top"><code>17</code></th>
<th class="tableblock halign-left valign-top"><code>+</code></th>
<th class="tableblock halign-left valign-top"><code>.</code></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stack result</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TOS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>17</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>19</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#x23B5;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NOS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#x23B5;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#x23B5;</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#x23B5;</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>We might also work in hexadecimal:<br>
<code>hex 0a 14 * .</code> &#x23CE; <code>c8 &lt;$,ram&gt;</code><br>
This number base is probably convenient for most embedded systems work,
where setting and monitoring bit patterns forms a large part of the code.
If you want to explicitly indicate the base of a number, you can prepend a sigil to the
digits of the number.
For example, <code>$10</code>, <code>#16</code> and <code>%10000</code> all represent the decimal value sixteen.</p>
</div>
<div class="paragraph">
<p>If the incoming text cannot be located in the dictionary nor interpreted as a number,
FlashForth issues an error message.<br>
<code>$0A</code> &#x23CE; <code>$0A ?</code><br>
<code>thing</code> &#x23CE; <code>thing ?</code><br>
Note that the apparent hexadecimal number <code>$0A</code> was not interpreted as such
because of the case sensitivity of FlashForth.<br>
<code>decimal $0a</code> &#x23CE; <code>ok&lt;#,ram&gt;10</code><br>
This time, the hexadecimal number was recognized and its value appears on the stack,
which is printed (in base ten) after the <code>ok</code> response.
To assist with the handling of numbers with many digits,
FlashForth allows the convenience of embedding periods into the text of the number.
This is most useful for binary numbers, but it works generally.<br>
<code>hex</code> &#x23CE; <code>ok&lt;$,ram&gt;</code><br>
<code>%0100.0000.0000.0000</code> &#x23CE; <code>ok&lt;$,ram&gt;4000</code><br>
<code>$4000</code> &#x23CE; <code>ok&lt;$,ram&gt;4000 4000</code><br>
<code>$4.0.0.0</code> &#x23CE; <code>ok&lt;$,ram&gt;4000 4000 4000</code><br>
<code>$4.</code> &#x23CE; <code>ok&lt;$,ram&gt;4000 4000 4000 4 0</code><br>
<code>decimal</code> &#x23CE; <code>ok&lt;#,ram&gt;16384 16384 16384 4 0</code><br>
Note that the period after the number resulted in a double value being placed
on the stack as two (separate) items.</p>
</div>
<div class="paragraph">
<p>Other error messages that you might see include <code>SP ?</code>, for a stack pointer error,
and <code>CO ?</code>, for a context error.
If the word * was to be executed without there being at least two numbers sitting
on the stack, the interpreter would abort, issuing the <code>SP</code> error message,
and then wait for new input.<br>
<code>*</code> &#x23CE; <code>ok&lt;#,ram&gt; SP?</code></p>
</div>
<div class="paragraph">
<p>Finally, to show the compilation and use of a new word,
here is the classic <em>Hello World!</em> program.<br>
<code>: hey ." Hello, World!" ;</code> &#x23CE; <code>ok&lt;#,ram&gt;</code><br>
Forth lets you output text using the word <code>."</code> while the words <code>:</code> and <code>;</code>
begin and end the definition of your own word <code>hey</code>.
Note that blank characters are used to delimit each of these words.
Now, type in <code>hey</code> and see what happens.<br>
<code>hey</code> &#x23CE; <code>Hello, World! ok&lt;#,ram&gt;</code></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_extending_the_dictionary">4. Extending the dictionary</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Forth belongs to the class of Threaded Interpretive Languages.
This means that it can interpret commands typed at the console,
as well as compile new subroutines and programs.
The Forth compiler is part of the language and special words are
used to make new dictionary entries (<em>i.e.</em> words).
The most important are <code>:</code> (start a new definition) and
<code>;</code> (terminate the definition).
Let&#8217;s try this out by typing:<br>
<code>: *+  *  +  ;</code> &#x23CE; <code>ok&lt;#,ram&gt;</code><br>
What happened?
The action of <code>:</code> is to create a new dictionary entry named <code>*+</code> and
switch from <em>interpret</em> to <em>compile</em> mode.
In compile mode, the interpreter looks up words and, rather than executing them,
installs pointers to their code.
If the text is a number, instead of pushing it onto the stack, FlashForth builds
the number into the dictionary space allotted for the new word,
following special code that puts the stored number onto the stack whenever the
word is executed.
The run-time action of <code>*+</code> is thus to execute sequentially the previously-defined words
<code>*</code> and <code>+</code></p>
</div>
<div class="paragraph">
<p>The word <code>;</code> is special.
It is an <em>immediate</em> word and is always executed, even if the system is in compile mode.
What <code>;</code> does is twofold.
First, it installs the code that returns control to the next outer level
of the interpreter and, second, it switched back from compile mode to interpret mode.</p>
</div>
<div class="paragraph">
<p>Now, try out your new word:<br>
<code>5 6 7 *+ .</code> &#x23CE; <code>47 ok&lt;#,ram&gt;</code><br>
This example illustrated two principal activities of working in Forth:
adding a new word to the dictionary, and trying it out as soon as it was defined.</p>
</div>
<div class="paragraph">
<p>Note that, in FlashForth, names of dictionary entries are limited to 15 characters.
Also, FlashForth will not redefine a word that already exists in the dictionary.
This can be convenient as you build up your library of Forth code because it allows
you to have repeated definitions, say for special function registers, in several files
and not have to worry about the repetition.</p>
</div>
<div class="sect2">
<h3 id="_dictionary_management">4.1. Dictionary management</h3>
<div class="paragraph">
<p>The word <code>empty</code> will remove all dictionary entries that you have made and
reset all memory allocations to the original values of the core FlashForth interpreter.
As you develop an application, it will often be convenient to return to an earlier,
intermediate dictionary and memory allocation state.
This can be done with the word <code>marker</code>.
For example, we could issue the command</p>
</div>
<div class="listingblock">
<div class="content">
<pre>marker -my-mark</pre>
</div>
</div>
<div class="paragraph">
<p>Later, after we have done some work with the FlashForth system and
defined a few of our own words and variables,
we can return the dictionary and memory allocation to the earlier state
by executing the word <code>-my-mark</code>.
Here, we have arbitrarily chosen the word <code>-my-mark</code>
so it would be good to choose a word that has
some specific and easily remembered meaning for us.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_stacks_and_reverse_polish_notation">5. Stacks and reverse Polish notation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The stack is the Forth analog of a pile of cards with numbers written on them.
The numbers are always added to the top of the pile, and removed from the top of the pile.
FlashForth incorporates two stacks: the parameter stack and the return stack,
each consisting of a number of cells that can hold 16-bit numbers.</p>
</div>
<div class="paragraph">
<p>The Forth input line<br>
<code>decimal 2 5 73 -16</code> &#x23CE;<br>
leaves the parameter stack in the state<br></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">cell number</th>
<th class="tableblock halign-left valign-top">content</th>
<th class="tableblock halign-left valign-top">comment</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-16</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TOS</code> (Top Of Stack)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>73</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NOS</code> (Next On Stack)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>5</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#x23B5;</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>We will usually employ zero-based relative numbering in Forth data structures
such as stacks, arrays and tables.
Note that, when a sequence of numbers is entered like this, the right-most number
becomes TOS and the left-most number sits at the bottom of the stack.</p>
</div>
<div class="paragraph">
<p>Suppose that we followed the original input line with the line<br>
<code>+ - * .</code> &#x23CE;<br>
to produce a value <em>xxx</em>.
What would the <em>xxx</em> be?
The operations would produce the successive stacks:<br></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">word executed</th>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top"><code>+</code></th>
<th class="tableblock halign-left valign-top"><code>-</code></th>
<th class="tableblock halign-left valign-top"><code>*</code></th>
<th class="tableblock halign-left valign-top"><code>.</code></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stack result</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TOS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-16</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>57</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-52</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-104</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#x23B5;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NOS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>73</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>5</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#x23B5;</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>5</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#x23B5;</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#x23B5;</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#x23B5;</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>So, after both lines, the terminal window shows</p>
</div>
<div class="listingblock">
<div class="content">
<pre>decimal 2 5 73 -16  ok&lt;#,ram&gt;2 5 73 65520
+ - * . -104  ok&lt;#,ram&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Note that FlashForth conveniently displays the stack elements on interpreting each line
and that the value of -16 is displayed as the 16-bit unsigned integer 65520.
Also, the word <code>.</code> consumes the -104 data value, leaving the stack empty.
If we execute <code>.</code> on the now-empty stack, the outer interpreter aborts with
a stack pointer error (<code>SP ?</code>).</p>
</div>
<div class="paragraph">
<p>The programming notation where the operands appear first,
followed by the operator(s) is called reverse Polish notation (RPN).
It will be familiar to students who own RPN calculators made by Hewlett-Packard.</p>
</div>
<div class="sect2">
<h3 id="_manipulating_the_parameter_stack">5.1. Manipulating the parameter stack</h3>
<div class="paragraph">
<p>Being a stack-based system, FlashForth must provide ways to put numbers onto the stack,
to remove them and to rearrange their order.
We&#8217;ve already seen that we can put numbers onto the stack by simply typing the number.
We can also incorporate the number into the definition of a Forth word.</p>
</div>
<div class="paragraph">
<p>The word <code>drop</code> removes a number from the TOS thus making NOS the new TOS.
The word <code>swap</code> exchanges the top 2 numbers.
<code>dup</code> copies the TOS into NOS, pushing all of the other numbers down.
<code>rot</code> rotates the top 3 numbers, bring the number that was just below NOS to the TOS.
These actions are shown below.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">word executed</th>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top"><code>drop</code></th>
<th class="tableblock halign-left valign-top"><code>swap</code></th>
<th class="tableblock halign-left valign-top"><code>rot</code></th>
<th class="tableblock halign-left valign-top"><code>dup</code></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stack result</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TOS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-16</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>73</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>5</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NOS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>73</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>5</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>73</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>5</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>5</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>73</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>5</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#x23B5;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#x23B5;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#x23B5;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>73</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#x23B5;</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#x23B5;</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>FlashForth also includes the words <code>over</code>, <code>tuck</code> and <code>pick</code> that act as shown below.
<code>over</code> makes a copy of NOS and then leaves it as the new TOS.
<code>tuck</code> make a copy of the TOS and inserts the copy just below the NOS.
Note that <code>pick</code> must be preceeded by an integer that (gets put on the stack briefly and)
says where on the stack an element gets picked.
Also, for the PIC18 version of FlashForth,
the definition of <code>pick</code> is provided as Forth source code in the file <code>pick.fs</code>.
The content of this file must be sent to the microcontroller to define the word before we try to use it.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">word executed</th>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top"><code>over</code></th>
<th class="tableblock halign-left valign-top"><code>tuck</code></th>
<th class="tableblock halign-left valign-top"><code>4 pick</code></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stack result</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TOS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-16</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>73</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>73</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>5</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NOS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>73</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-16</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-16</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>73</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>5</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>73</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>73</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-16</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>5</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>73</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>73</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#x23B5;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>5</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>73</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#x23B5;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>5</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#x23B5;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#x23B5;</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>From these actions, we can see that <code>0 pick</code> is the same as <code>dup</code>,
<code>1 pick</code> is a synonym for <code>over</code>.
The word <code>pick</code> is mainly useful for dealing with deep stacks, however,
you should avoid making the stack deeper than 3 or 4 elements.
If you are finding that you often have to reason about deeper stacks,
consider how you might refactor your program.</p>
</div>
<div class="paragraph">
<p>Double length (32-bit) numbers can also be handled in FlashForth.
A double number will sit on the stack as a pair of 16-bit cells,
with the cell containing the least-significant 16-bits
sitting below the cell containing the most-significant 16-bits.
The words for manipulating pairs of cells on the parameter stack are
<code>2dup</code>, <code>2swap</code>, <code>2over</code> and <code>2drop</code>.
For example, we can put a double value onto the stack by putting a period
as the last character of the number literal.<br>
<code>hex 23.</code> &#x23CE; <code>ok&lt;$,ram&gt;23 0</code></p>
</div>
<div class="paragraph">
<p>Memory on microcontrollers is limited and,
for FlashForth on the PIC18, the parameter stack is limited to 26 cells.
If you accumulate too many items on the stack,
it will overflow and the interpreter will abort.
The stack will be emptied and the interpreter will wait for further input.</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_return_stack_and_its_uses">5.2. The return stack and its uses</h3>
<div class="paragraph">
<p>During compilation of a new word, FlashForth establishes links from the calling word
to the previously-defined words that are to be invoked by execution of the new word.
This linkage mechanism, during execution, uses the return stack (rstack).
The address of the next word to be invoked is placed on the rstack so that,
when the current word is done executing, the system knows where to jump
to the next word.
Since words can be nested, there needs to be a stack of these return addresses.</p>
</div>
<div class="paragraph">
<p>In addition to serving as the reservoir of return addresses,
the return stack is where the counter for the <code>for &#8230;&#8203; next</code> construct is placed.
(See the section on looping.)
The user can also store to and retrieve from the rstack but this must be done carefully
because the rstack is critical to program execution.
If you use the rstack for temporary storage, you must return it to its original state,
or else you will probably crash the FlashForth system.
Despite the danger, there are times when use of the rstack as temporary storage can make
your code less complex.</p>
</div>
<div class="paragraph">
<p>To store to the rstack, use <code>&gt;r</code> to move TOS from the parameter stack
to the top of the rstack.
To retrieve a value, <code>r&gt;</code> moves the top value from the rstack
to the parameter stack TOS.
To simply remove a value from the top of the rstack there is the word <code>rdrop</code>.
The word <code>r@</code> copies the top of the rstack to the parameter stack TOS
and is used to get a copy of the loop counter in a <code>for</code> loop
discussed in the section on looping.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_memory">6. Using memory</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As well as static RAM, the PIC18 microcontroller has program memory, or Flash memory,
and also EEPROM.
Static RAM is usually quite limited on PIC18 controllers and the data stored there is
lost if the MCU loses power.
The key attribute of RAM is that it has an unlimited endurance for being rewritten.
The Flash program memory is usually quite a bit larger and is retained,
even with the power off.
It does, however, have a very limited number of erase-write cycles that it can endure.
EEPROM is also available, in even smaller amounts than static RAM and is non-volatile.
It has a much better endurance than Flash, but any particular cell
is still limited to about 100000 rewrites.
It is a good place to put variables that you change occasionally but
must retain when the power is off.
Calibration or configuration data may be an example of the type of data
that could be stored in EEPROM.
The registers that configure, control and monitor the microcontroller&#8217;s peripheral devices
appear as particular locations in the static RAM memory.</p>
</div>
<div class="paragraph">
<p>In FlashForth, 16-bit numbers are fetched from memory to the stack by the word <code>@</code> (fetch)
and stored from TOS to memory by the word <code>!</code> (store).
<code>@</code> expects an address on the stack and replaces the address by its contents.
<code>!</code> expects a number (NOS) and an address (TOS) to store it in.
It places the number in the memory location referred to by the address,
consuming both parameters in the process.</p>
</div>
<div class="paragraph">
<p>Unsigned numbers that represent 8-bit (byte) values can be placed in character-sized cells
of memory using <code>c@</code> and <code>c!</code>.
This is convenient for operations with strings of text, but is especially useful
for handling the microcontroller&#8217;s peripheral devices via their special-function
file registers.
For example, data-latch register for port B digital input-output
is located at address <code>$ff8a</code>
and the corresponding tristate-control register at address <code>$ff93</code>.
We can set pin RB0 as an output pin by setting the corresponding bit in the
tristate control register to zero.<br>
<code>%1111.1110 $ff93 c!</code> &#x23CE; <code>ok&lt;$,ram&gt;</code><br>
and then set the pin to a digital-high value by writing a 1 to the port&#8217;s latch register<br>
<code>1 $ff8a c!</code> &#x23CE; <code>ok&lt;$,ram&gt;</code><br>
If we had a light-emitting diode attached to this pin, via a current-limiting resistor,
we should now see it light up as in the companion hardware tutorial.
Here is what the terminal window contains after turning the LED on and off a couple of times.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>warm
S FlashForth 5 PIC18F26K22 11.11.2016

%1111.1110 $ff93 c!  ok&lt;#,ram&gt;
1 $ff8a c!  ok&lt;#,ram&gt;
0 $ff8a c!  ok&lt;#,ram&gt;
1 $ff8a c!  ok&lt;#,ram&gt;
0 $ff8a c!  ok&lt;#,ram&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Note that we started the exercise with a <em>warm</em> restart so that the FlashForth
environment was in a known good state.
Being interactive, FlashForth allows you to play with the hardware very easily.</p>
</div>
<div class="sect2">
<h3 id="_variables">6.1. Variables</h3>
<div class="paragraph">
<p>A variable is a named location in memory that can store a number,
such as the intermediate result of a calculation, off the stack.
For example,<br>
<code>variable x</code> &#x23CE; <code>ok&lt;#,ram&gt;</code><br>
creates a named storage location, <code>x</code> which executes by leaving the address
of its storage location as TOS:<br>
<code>x</code> &#x23CE; <code>ok&lt;#,ram&gt;61806</code><br>
We can then fetch from or store to this address as described in the previous section.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>empty warm
S FlashForth 5 PIC18F26K22 11.11.2016

marker -play  ok&lt;#,ram&gt;
variable x  ok&lt;#,ram&gt;
3 x !  ok&lt;#,ram&gt;
x @ . 3  ok&lt;#,ram&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>For FlashForth, the dictionary entry, <code>x</code>,
is in the Flash memory of the microcontroller but the
storage location for the number is in static RAM (in this instance).
Note that the <code>empty</code> word was used to discard all dictionary entries that
we may have made on top of the base system.
If you are unsure of what dictionary entries you have made,
use <code>words</code> to display all current dictionary entries.</p>
</div>
<div class="paragraph">
<p>FlashForth provides the words <code>ram</code>, <code>flash</code> and <code>eeprom</code>
to change the memory context of the storage location.
Being able to conveniently handle data spaces in different
memory types is a major feature of FlashForth.
To make another variable in EEPROM, try<br>
<code>eeprom variable y</code> &#x23CE; <code>ok&lt;#,eeprom&gt;</code><br>
We can access this new (nonvolatile) variable as we did for the RAM variable <code>x</code>,
but <code>y</code> retains its value, even when we turn off and on the power to the microcontroller.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>4 y !  ok&lt;#,eeprom&gt;
y @ . 4  ok&lt;#,eeprom&gt;
x @ . 3  ok&lt;#,eeprom&gt;

 FlashForth 5 PIC18F26K22 11.11.2016

y @  ok&lt;#,ram&gt;4
x @  ok&lt;#,ram&gt;4 0</pre>
</div>
</div>
<div class="paragraph">
<p>In the example above, we reset the microcontroller by bringing its MCLR pin low for a moment.</p>
</div>
</div>
<div class="sect2">
<h3 id="_constants">6.2. Constants</h3>
<div class="paragraph">
<p>A constant is a number that you would not want to change during a program&#8217;s execution.
The addresses of the microcontroller&#8217;s special-function registers are a good example
of use and, because the constant numbers are stored in nonvolatile Flash memory, they are
available even after a hardware reset.
The result of executing the word associated with a constant is the data value being left on the stack.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ff93 constant trisb  ok&lt;#,ram&gt;
$ff8a constant latb  ok&lt;#,ram&gt;
%1111.1110 trisb c!  ok&lt;#,ram&gt;
0 latb c!  ok&lt;#,ram&gt;
1 latb c!  ok&lt;#,ram&gt;
0 latb c!  ok&lt;#,ram&gt;

 FlashForth 5 PIC18F26K22 11.11.2016

hex trisb   ok&lt;$,ram&gt;ff93
%1111.1110 trisb c!  ok&lt;$,ram&gt;ff93
0 latb c!  ok&lt;$,ram&gt;ff93
1 latb c!  ok&lt;$,ram&gt;ff93</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_values">6.3. Values</h3>
<div class="paragraph">
<p>A <code>value</code> is a hybrid type of variable and constant.
We define and initialize a value and invoke it as as we would for a constant.
We can also change a value as we can a variable.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>decimal  ok&lt;#,ram&gt;
13 value thirteen  ok&lt;#,ram&gt;
thirteen  ok&lt;#,ram&gt;13
47 to thirteen  ok&lt;#,ram&gt;13
thirteen  ok&lt;#,ram&gt;13 47</pre>
</div>
</div>
<div class="paragraph">
<p>The word <code>to</code> also works within word definitions, replacing the value that
follows it with whatever is currently in TOS.
You must be careful that <code>to</code> is followed by a value and not something else.</p>
</div>
</div>
<div class="sect2">
<h3 id="_basic_tools_for_allocating_memory">6.4. Basic tools for allocating memory</h3>
<div class="paragraph">
<p>The words <code>create</code> and <code>allot</code> are the basic tools for setting aside memory
and attaching a convenient label to it.
For example, the following transcript shows a new dictionary entry <code>x</code> being created
and an extra 16 bytes of memory being allotted to it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>empty warm
S FlashForth 5 PIC18F26K22 11.11.2016

hex  ok&lt;$,ram&gt;
create x  ok&lt;$,ram&gt;
x u. f16e  ok&lt;$,ram&gt;
here u. f16e  ok&lt;$,ram&gt;
10 allot  ok&lt;$,ram&gt;
here u. f17e  ok&lt;$,ram&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>When executed, the word <code>x</code> will push the address of the first entry
in its allotted memory space onto the stack.
The word <code>u.</code> prints an unsigned representation of a number and
the word <code>here</code> returns the address of the next available space in memory.
In the example above, it starts with the same value as <code>x</code> but is incremented
by (decimal) sixteen when we allotted the memory.</p>
</div>
<div class="paragraph">
<p>We can now access the memory allotted to <code>x</code> using the fetch and store words
discussed earlier, in the section on memory.
To compute the address of the third byte allotted to <code>x</code> we could say <code>x 2 +</code>,
remembering that indices start at 0.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>30 x 2 + c!  ok&lt;$,ram&gt;
x 2 + c@  ok&lt;$,ram&gt;30</pre>
</div>
</div>
<div class="paragraph">
<p>We will discuss a way to neatly package the snippets of code required to do the address
calculation later, in the section on creating arrays.
Finally, note that the memory context for this example has been the static RAM, however,
(as shown for variables in the section on variables)
the context for allotting the memory can be changed.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comparing_and_branching">7. Comparing and branching</h2>
<div class="sectionbody">
<div class="paragraph">
<p>FlashForth lets you compare two numbers on the stack, using the relational
operators <code>&gt;</code>, <code>&lt;</code> and <code>=</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>hex  ok&lt;$,ram&gt;
2 3 =  ok&lt;$,ram&gt;0
2 3 &gt;  ok&lt;$,ram&gt;0 0
2 3 &lt;  ok&lt;$,ram&gt;0 0 ffff
. -1  ok&lt;$,ram&gt;0 0</pre>
</div>
</div>
<div class="paragraph">
<p>These operators consume both arguments and leave a <em>flag</em>,
to represent the boolean result.
Above, we see that "2 is equal to 3" is false (value 0),
"2 is greater than 3" is also false, while
"2 is less than 3" is true.
The true flag has all bits set to 1, hence the 16-bit hexadecimal representation <code>ffff</code>
and the corresponding signed representation <code>-1</code>.
FlashForth also provides the relational operators <code>0=</code> and <code>0&lt;</code>
which test if the TOS is zero and negative, respectively.</p>
</div>
<div class="paragraph">
<p>The relational words are used for branching and control.
For example, after a warm restart, we can define the word <code>test</code> and try it</p>
</div>
<div class="listingblock">
<div class="content">
<pre>: test 0= invert if cr ." Not zero!" then ;  ok&lt;#,ram&gt;
0 test  ok&lt;#,ram&gt;
-14 test
Not zero! ok&lt;#,ram&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>The TOS is compared with zero and the <code>invert</code> operator (ones complement) flips
all of the bits in the resulting flag.
If TOS is nonzero, the word <code>if</code> consumes the flag and executes all of the words
between itself and the terminating <code>then</code>.
If TOS is zero, execution jumps to the word following the <code>then</code>.
The word <code>cr</code> issues a carriage return (newline).</p>
</div>
<div class="paragraph">
<p>The word <code>else</code> can be used to provide an alternate path of execution as shown here.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>: truth 0= if ." false" else ." true" then ;  ok&lt;#,ram&gt;
1 truth true ok&lt;#,ram&gt;
0 truth false ok&lt;#,ram&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>A nonzero TOS causes words between the <code>if</code> and <code>else</code> to be executed,
and the words between <code>else</code> and <code>then</code> to be skipped.
A zero value produces the opposite behaviour.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments_in_forth_code">8. Comments in Forth code</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The word <code>(</code>&#8201;&#8212;&#8201;a left parenthesis followed by a space&#8201;&#8212;&#8201;says "disregard all following text until the next right parenthesis
or end-of-line in the input stream".
Thus we can add explanatory comments to colon definitions.</p>
</div>
<div class="paragraph">
<p>Stack comments are a particular form of parenthesized remark which describes
the effect of a word on the stack.
For example the comment <code>( x&#8201;&#8212;&#8201;x x)</code> could be used as the stack-effect comment
for the word <code>dup</code>.
The comment indicates that the word will make a copy of TOS and add it to the stack,
leaving the original value, now as NOS.</p>
</div>
<div class="paragraph">
<p>The word <code>\</code> (backslash followed by a space) is known as drop-line and is also
available as a method of including longer comments.
Upon executing, it drops everything from the input stream until the next carriage-return.
Instructions to the user, clarifications of usage examples can be conveniently expressed
in a block of text, with each line started by a backslash.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_integer_arithmetic_operations">9. Integer arithmetic operations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>With FlashForth having 16-bit cells, the standard arithmetic operators
shown in Table 1 below
operate on 16-bit signed integers, in the range <code>-32768</code> to <code>+32767</code> (decimal).
Note that the word <code>u*/mod</code> (scale) uses a 32-bit intermediate result.
FlashForth also provides arithmetic operators
for double numbers (32-bit integers), signed and unsigned.
See the companion quick reference sheet for a more complete list.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Arithmetic operators for single (16-bit) numbers.</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">word</th>
<th class="tableblock halign-left valign-top">effect</th>
<th class="tableblock halign-left valign-top">comment</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>+</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>( n1 n2&#8201;&#8212;&#8201;n1+n2)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sum</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>( n1 n2&#8201;&#8212;&#8201;n1-n2)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">difference</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>( n1 n2&#8201;&#8212;&#8201;n1*n2)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">product</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>( n1 n2&#8201;&#8212;&#8201;n1/n2)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">quotient</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mod</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>( n1 n2&#8201;&#8212;&#8201;n.rem)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">remainder</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>*/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>( n1 n2 n3&#8201;&#8212;&#8201;n1*n2/n3)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">scaled quotient</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>u/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>( u1 u2&#8201;&#8212;&#8201;u1/u2)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">unsigned quotient</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>u/mod</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>( u1 u2&#8201;&#8212;&#8201;rem quot)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">remainder and quotient</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>u*/mod</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>( u1 u2 u3&#8201;&#8212;&#8201;rem quot)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">scaled remainder and quotient</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For an example of using arithmetic operators, consider the
conversion of temperature values from Celcius to Fahrenheit
using the formula <code>n2 = (n1*9/5 + 32)</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>decimal  ok&lt;#,ram&gt;
: to-f-1 ( n1 -- n2) 9 * 5 / #32 + ;  ok&lt;#,ram&gt;
0 to-f-1 . 32  ok&lt;#,ram&gt;
100 to-f-1 . 212  ok&lt;#,ram&gt;
500 to-f-1 . 932  ok&lt;#,ram&gt;
5000 to-f-1 . -4075  ok&lt;#,ram&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>This simple function works fine, up until the intermediate result
<code>(n1*9)</code> overflows the 16-bit cell.
With a bit more bother, we can make use of the scaled operator
to avoid overflow of the intermediate result.
Again, the following function computes expression <code>(u1*9/5 + 32)</code>
but now uses the scale operator <code>*/</code>.
This operator uses a 32-bit intermediate result to avoid overflow.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>: to-f-2 ( n1 -- n2) 9 5 */ #32 + ;  ok&lt;#,ram&gt;
0 to-f-2 . 32  ok&lt;#,ram&gt;
100 to-f-2 . 212  ok&lt;#,ram&gt;
500 to-f-2 . 932  ok&lt;#,ram&gt;
5000 to-f-2 . 9032 ok&lt;#,ram&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Note that not all of the arithmetic operators are part of the core FlashForth
that is written in PIC18 assembly language and, to get the scale operator,
you will need to load the <code>math.fs</code> file of word definitions before
trying this second example.
This file is available in the common forth source directory of the FlashForth distribution.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_a_little_more_on_compiling">10. A little more on compiling</h2>
<div class="sectionbody">
<div class="paragraph">
<p>While compiling, it is possible to temporarily switch to interpreter mode
with the word <code>[</code> and switch back into compile mode with <code>]</code>.
The following example defines the word \verb!feet! that converts a number
representing a length in feet to an equivalent number of millimetres.
The intermediate result is in tenths of a millimetre so that precision is retained and,
to make the conversion clear, the numeric conversion factor is computed
as we compile the word.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>: feet ( u1 -- u2)
  [ #254 #12 * ] literal #10 u*/mod
  swap drop ;  ok&lt;#,ram&gt;
10 feet  ok&lt;#,ram&gt;3048</pre>
</div>
</div>
<div class="paragraph">
<p>The word <code>literal</code> is used to compile the data value in TOS
into the definition of <code>feet</code>.
At run-time, that data value will be placed onto the stack.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_looping_and_structured_programming">11. Looping and structured programming</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The control words available for structured programming are shown in Table 2,
where <code>xxx</code> and <code>yyy</code> denote sequences of words and
<code>cond</code> denotes a boolean flag value.
Within the body of a <code>for</code> loop, you may get the loop counter with the word <code>r@</code>.
It counts from <em>u</em>-1 down to 0.
If you <code>exit</code> from a for loop, you must drop the loop count with <code>rdrop</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Flow control in FlashForth.</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>cond</em> <code>if</code> <em>xxx</em> <code>else</code> <em>yyy</em> <code>then</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Conditional execution.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>begin</code> <em>xxx</em> <code>again</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Infinite loop.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>begin</code> <em>xxx</em> <em>cond</em> <code>until</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Loop until <em>cond</em> is true.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>begin</code> <em>xxx</em> <em>cond</em> <code>while</code> <em>yyy</em> <code>repeat</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Loop while <em>cond</em> is true, <em>yyy</em> is not executed
                                                on the last iteration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>u</em> <code>for</code> <em>xxx</em> <code>next</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Loop <em>u</em> times.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>endit</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets loop counter to zero so that we leave the loop
                                                when <code>next</code> is encountered.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>exit</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exit from a word.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Here are a couple of examples of counted loops,
one constructed from the generic <code>begin</code> &#8230;&#8203; <code>until</code> construct,
and the other using the dedicated <code>for</code> &#8230;&#8203; <code>next</code> construct.
Note the difference in counter ranges.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>-countdown  ok&lt;#,ram&gt;
marker -countdown  ok&lt;#,ram&gt;
: countdown1 ( n --)
  begin cr dup . 1- dup 0= until
  drop ;  ok&lt;#,ram&gt;
5 countdown1
5
4
3
2
1  ok&lt;#,ram&gt;
: countdown2 ( n --)
  for cr r@ . next ;  ok&lt;#,ram&gt;
5 countdown2
4
3
2
1
0  ok&lt;#,ram&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>It was convenient, when setting up these examples, to put the source code into a little file
that could be reloaded easily each time the source text was changed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>-countdown
marker -countdown
: countdown1 ( n --)
  begin cr dup . 1- dup 0= until
  drop ;
5 countdown1
: countdown2 ( n --)
  for cr r@ . next ;
5 countdown2</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_more_on_defining_words">12. More on defining words</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The compiler word <code>create</code> makes a new dictionary entry
using the next name in the input stream and compiles the pointer value
of the first free location of the current data-space context.
When executed, the new dictionary entry leaves that pointer value on the stack.</p>
</div>
<div class="paragraph">
<p><code>create</code> can be used to build other defining words.
For example, we can make our own variation of word <code>variable</code> as</p>
</div>
<div class="listingblock">
<div class="content">
<pre>: make-var create 1 cells allot ;  ok&lt;#,ram&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Here <code>make-var</code> can be used to make an uninitialized variable that can hold a single number.
When <code>make-var</code> is executed, the first word within its definition (<code>create</code>)
sets up a dictionary entry with the name coming from the next text in the input stream
(<code>alpha</code> in the example below),
the number 1 is pushed onto the stack, the word <code>cells</code> converts the TOS to the
appropriate number of bytes (2 in this case) and the word <code>allot</code> increments
the pointer to the next available space in memory by this number of bytes.
This allots one cell to the newly created <em>child</em> word.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>make-var alpha  ok&lt;#,ram&gt;
13 alpha !  ok&lt;#,ram&gt;
alpha @ . 13  ok&lt;#,ram&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>At run time for the newly created <em>child</em> word, <code>alpha</code> leaves its data-space address
on the stack and we may store to or fetch from this address, as shown above.</p>
</div>
<div class="paragraph">
<p>As a second example, we can also build a defining word for making initialized variables.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>: make-zero-var create 0 , ;  ok&lt;#,ram&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Instead of just allotting space for the data,
the word <code>,</code> (comma) puts TOS into the next cell of memory and increments
the memory-space pointer by appropriate number of bytes.
Run time use of the newly defined variable is the same as for any other variable.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>make-zero-var beta  ok&lt;#,ram&gt;
beta @ . 0  ok&lt;#,ram&gt;</pre>
</div>
</div>
<div class="sect2">
<h3 id="_create_does">12.1. create &#8230;&#8203; does&gt; &#8230;&#8203;</h3>
<div class="paragraph">
<p>The word <code>does&gt;</code> is used to specify a run-time action for the child words of
a defining word.
We can make our own variant of <code>constant</code> and test it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>: make-con create , does&gt; @ ;  ok&lt;#,ram&gt;
53 make-con prime  ok&lt;#,ram&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>At run time for the defining word <code>make-con</code>,
create sets up the new dictionary entry with the
next text in the input stream (<code>prime</code>), the word <code>,</code> (comma) compiles TOS
(53 in this example) into the memory-space of the new child word and
<code>does&gt;</code> stores the following words up to the terminating
semicolon (only <code>@</code> in this case), such that they will be executed at the run time
of the child word defined by <code>make-con</code>.
Thus, when <code>prime</code> is executed, the address of the first entry in its data-space
is put onto the stack and the word <code>@</code> executed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>prime . 53  ok&lt;#,ram&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Although only one word is stored as the run time code for <code>prime</code> in this example,
it could be arbitrarily complex.</p>
</div>
</div>
<div class="sect2">
<h3 id="_creating_arrays">12.2. Creating arrays</h3>
<div class="paragraph">
<p>The <code>create</code> &#8230;&#8203; <code>does&gt;</code> pair can be used to define some convenient
array-defining words.
For an array of bytes, it is straight-forward to manually allot the
memory and address it at run time.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>create my-array 10 allot  ok&lt;#,ram&gt;
my-array 10 $ff fill  ok&lt;#,ram&gt;
my-array @ .  -1  ok&lt;#,ram&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Here, <code>my-array</code> is first allotted 10 bytes.
At run time for <code>my-array</code>, the address of the start of the 10 bytes is left on
the stack, and we use the <code>fill</code> word (found in the Forth source file <code>core.fs</code>)
to completely fill the array of bytes with ones.
Accessing the first cell (2 bytes) and printing it (to get <code>-1</code> sent to the serial port)
confirms that all bits are 1s.
The word <code>dump</code> can be used to get a more complete picture.
It expects the starting address and number of bytes to dump sitting on the stack.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>hex  ok&lt;$,ram&gt;
my-array $30 dump
f174 :ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ................
f184 :00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................
f194 :00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................ ok&lt;$,ram&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Note that <code>dump</code> works with blocks of 16 bytes and that the dots to the right
show a character representation of the byte values.
This is convenient when trying to identify strings of text.</p>
</div>
<div class="paragraph">
<p>It is also straight-forward to create an array with particular data compiled in.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>create my-cell-array 100 , 340 , 5 ,  ok&lt;$,ram&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Remember to use <code>,</code> (comma) to compile in every data element, not leaving off the last one.
At run time, <code>my-cell-array</code> puts the address of the start of the associated memory
on the stack and the address of the desired cell (index 2, in this case)
needs to be calculated (<code>2 cells +</code>) before executing <code>@</code> (fetch).</p>
</div>
<div class="listingblock">
<div class="content">
<pre>my-cell-array 2 cells + @ . 5  ok&lt;$,ram&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>This address calculation code can be added into the defining word with <code>does&gt;</code>
such that the subsequently defined my-cells array will have the snippet of code
(<code>swap cells +</code>) executed at run time to convert from a cell index to an address.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>\ A defining word for creating arrays.
: mk-cell-array ( u --)
  create cells allot
  does&gt; swap cells + ;  ok&lt;$,ram&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>swap</code> is used to get the index as TOS with the array address as NOS,
<code>cells</code> scales the index to the offset as a number of bytes and <code>+</code> adds the
offset to the array address.
The newly computed cell address is left as TOS for use by the words <code>!</code> (store) and <code>@</code> (fetch).</p>
</div>
<div class="listingblock">
<div class="content">
<pre>\ Make an array and access it.
5 mk-cell-array my-cells  ok&lt;$,ram&gt;
3000 0 my-cells !  ok&lt;$,ram&gt;
3001 1 my-cells !  ok&lt;$,ram&gt;
3002 2 my-cells !  ok&lt;$,ram&gt;
1 my-cells @ . 3001  ok&lt;$,ram&gt;</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_jump_tables">12.3. Jump tables</h3>
<div class="paragraph">
<p>Sometimes we want to execute one of a large selection of words,
depending on the outcome of a calculation.
It is possible to set up a sequence of tests and branches
(as introduced in the section on comparing and branching),
however, FlashForth allows a neater
solution in the form of a <em>jump table</em>.
A word in FlashForth can be executed by feeding its <em>execution token</em>
to the word <code>execute</code>.
If you have a table of execution tokens, then you need only look up the
one corresponding to a given index, fetch it and say <code>execute</code>.
The following transcript shows such a jump-table for a collection of four functions,
the word <code>do-action</code> to execute the appropriate word, given an index,
and a sample of trials that shows the jump-table mechanism in action.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>\ Set up the words that we want to selectively execute.
: ring  ( --) ." ring ring" ;  ok&lt;#,ram&gt;
: open  ( --) ." opening" ;  ok&lt;#,ram&gt;
: laugh ( --) ." ha ha" ;  ok&lt;#,ram&gt;
: cry   ( --) ." crying" ;   ok&lt;#,ram&gt;

\ Store the execution tokens in a table that allots into flash memory.
flash  ok&lt;#,flash&gt;
create actions ' ring , ' open , ' laugh , ' cry ,  ok&lt;#,flash&gt;
ram  ok&lt;#,ram&gt;

: do-action ( n --)
  0 max 3 min
  cells actions + @ execute ;  ok&lt;#,ram&gt;

\ Call up the actions.
3 do-action crying ok&lt;#,ram&gt;
0 do-action ring ring ok&lt;#,ram&gt;
2 do-action ha ha ok&lt;#,ram&gt;
5 do-action crying ok&lt;#,ram&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>The word <code>'</code> (tick) finds the following name in the dictionary and
puts its execution token (xt) on the stack.
The word <code>,</code> (comma) compiles the xt into the table.
Note that we are compiling these tokens into the flash memory of the microcontroller
so that the jump table continues to work, even after a power break.
In <code>do-action</code>, the words <code>0 max 3 min</code> limit the incoming index value to
the valid range for looking up a token in the jump-table.
The token is fetched to TOS and then <code>execute</code> called.
The final line of the transcript shows that the word <code>cry</code> is executed for
the invalid index value of 5.
You may want to handle incorrect input differently in your application.</p>
</div>
<div class="paragraph">
<p>The FlashForth distribution comes with a file, <code>jmptbl.fs</code>
(in the common forth source code directory),
that provides set of words for building jump tables.
With these words, we can build a second jump table with a neater notation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>flash
JUMP_TABLE do-action-2
  0 | ring
  1 | open
  2 | laugh
  3 | cry
  default| cry
ram</pre>
</div>
</div>
<div class="paragraph">
<p>Note that, in the code above, we have omitted the FlashForth response on each line.
This new jump table gives essentially the same behaviour as the first one.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>\ Call up the actions.  ok&lt;$,ram&gt;
3 do-action-2 crying ok&lt;$,ram&gt;
0 do-action-2 ring ring ok&lt;$,ram&gt;
2 do-action-2 ha ha ok&lt;$,ram&gt;
5 do-action-2 crying ok&lt;$,ram&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Although not evident in this example, <code>JUMP_TABLE</code> allows more general key values
than we could use in the basic array implementation for <code>do-action</code>.
We could, for example, build a jump table with a selection of character codes as the keys.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_strings">13. Strings</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <em>Hello World!</em> program, back in the section on the interpreter,
could have been written a little differently, as the following transcript shows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>: hey2 s" Hello, World!" cr type ;  ok&lt;#,ram&gt;
hey2
Hello, World! ok&lt;#,ram&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>The word <code>s"</code> compiles the string into Flash memory and, at run time,
leaves the address of the string and the number of characters in the string
on the stack.
Using this information, the word <code>type</code> will send the characters to the standard output.</p>
</div>
<div class="sect2">
<h3 id="_pictured_numeric_output">13.1. Pictured numeric output</h3>
<div class="paragraph">
<p>To get numbers output in a particular format, FlashForth provides
the basic words <code><mark></code>, <code>&lt;</mark></code>, <code>#s</code>, <code>#&gt;</code>, <code>sign</code> and <code>hold</code>.
These words are intended for use within word definitions.
Here is an example of their use.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>: (d.2) ( d -- caddr u)
  tuck dabs &lt;# # # [char] . hold #s rot sign #&gt; ;  ok&lt;#,ram&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>A double number sits on the stack, with it most significant bits, including its sign, in TOS.
First, <code>tuck</code> copies TOS (with the sign bit) to below the double number and
then the absolute value is converted to a string of characters representing the unsigned
value.
Starting with the least significant digits, there will be two to the right of a decimal point.
The phrase <code>[char] . hold</code> adds the decimal point to the string.
In this phrase, <code>[char] .</code> builds in the representation of the decimal point
as a numeric literal
(ASCII code 46) and <code>hold</code> then adds it to the string under construction.
After adding the decimal point, the word <code>#s</code> converts as many remaining digits as required.
The word <code>rot</code> is used to bring the copy of the original most-significant cell to TOS
and the word <code>sign</code> adds a negative sign to the string if required.
Finally, word <code>#&gt;</code> finishes the conversion,
leaving the character-address of the resultant string
and the number of characters in it on the top of the stack.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>437658. (d.2) type 4376.58 ok&lt;#,ram&gt;
-437699. (d.2) type -4376.99 ok&lt;#,ram&gt;
45. (d.2) type 0.45 ok&lt;#,ram&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Note that, with FlashForth, double integers must be entered as literal values
with the decimal point as the last character.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_forth_programming_style">14. Forth programming style</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There is much written on the style of Forth programming and, indeed, there is book
called "Thinking Forth".<sup><a href="#brodie_2004">2</a></sup>
Here are a number of recurring statements on programming in Forth that are relevant
to sections of this tutorial:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Build your application from the bottom up, testing new words as you go.</p>
</li>
<li>
<p>Choose simple and meaningful names, so that the intent of each word is clear
and your code is easily read, almost as statements you would make to another person.</p>
</li>
<li>
<p>Always provide stack-effect comments.</p>
</li>
<li>
<p>As you build your application, refactor your code aggressively so that you
don&#8217;t need complicated stack manipulations to access your data.</p>
</li>
<li>
<p>Clean up after yourself and don&#8217;t leave rubbish on the stack.</p>
</li>
<li>
<p>Use the return-stack for temporary storage when it makes your code cleaner
but be very careful to clean up when doing so.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_references">References</h2>
<div class="sectionbody">
<div class="ulist bibliography">
<ul class="bibliography">
<li>
<p><a id="brodie_1987"></a>[1] Brodie, L. and Forth Inc. (1987) Starting Forth: An introduction to the Forth Language and operating system for beginners and professionals, 2nd Ed. <em>Prentice Hall</em>  ISBN 0-13-843079-9. Also, updated and online <a href="http://home.iae.nl/users/mhx/sf.html" class="bare">http://home.iae.nl/users/mhx/sf.html</a> and the official online version <a href="http://www.forth.com/starting-forth/" class="bare">http://www.forth.com/starting-forth/</a></p>
</li>
<li>
<p><a id="brodie_2004"></a>[2] Brodie, L. (2004) Thinking Forth: A Language and Philosophy for Solving Problems. <em>Punchy Publishing</em> ISBN 0976458705. Also online <a href="http://thinking-forth.sourceforge.net/" class="bare">http://thinking-forth.sourceforge.net/</a></p>
</li>
<li>
<p><a id="conklin_2007"></a>[3] Conklin, E. K. and Rather, E. D. (2007) Forth Programmer&#8217;s Handbook, 3rd Ed. <em>Forth Inc.</em> ISBN 1-4196-7549-4</p>
</li>
<li>
<p><a id="noble_2001"></a>[4] Noble, J. V. (2001) A Beginner&#8217;s Guide to Forth, <a href="http://galileo.phys.virginia.edu/classes/551.jvn.fall01/primer.htm" class="bare">http://galileo.phys.virginia.edu/classes/551.jvn.fall01/primer.htm</a></p>
</li>
<li>
<p><a id="pelc_2011"></a>[5] Pelc, S. (2011). Programming Forth. <em>Microprocessor Engineering Limited</em>, ISBN 978-0-9525310-5-0.  <a href="http://www.mpeforth.com/" class="bare">http://www.mpeforth.com/</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2022-01-06 08:13:43 +1000
</div>
</div>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "AMS" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains('stemblock')) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
</body>
</html>